<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
    <head>
        <title>test.app</title>
        
    </head>
    <body id="">
        <script src="http://connect.rapira9.mail.ru/js/loader.js" type="text/javascript" charset="utf-8"></script>
        <button id="payment" type="button" onclick="payment()">
            payment dialog
        </button>
        <button id="inviteFrineds" type="button" onclick="invite()">
            invite frineds
        </button>
		<button id="reviewApp" type="button" onclick="review()">
            review app
        </button>

		<button id="widget" type="button" onclick="permission('widget')">
            widget
        </button>
		<button id="stream" type="button" onclick="stream()">
            stream
        </button>
		<button id="guestbook" type="button" onclick="guestbook()">
            guestbook
        </button>
		<button id="album" type="button" onclick="createAlbum()">
            album
        </button>
		<button id="photo" type="button" onclick="upload()" style="display: none">
            upload photo
        </button>
		<br/>
		<textarea id="console" style="height: 500px; width: 100%; display: block;"></textarea>		
        <script type="text/javascript" charset="utf-8">
            function $(d){
                return document.getElementById(d) || false;
            }
			function cl(d){
				$('console').innerHTML += d + '\n';
			}
			var user = {}, aid = null;
            mailru.loader.require('api', function() {

              mailru.app.init('148480a53d12c753d8f8fca56e7f48d6');
			  mailru.app.users.getInfo(function(result){
			  	user = result[0];
			  });
			  mailru.events.listen(mailru.app.events.friendsInvitation, function(d){cl(collectData(d))});
              mailru.events.listen(mailru.app.events.paymentDialogStatus, function(d){cl(collectData(d))});
              mailru.events.listen(mailru.app.events.incomingPayment, function(d){cl(collectData(d))});
			  mailru.events.listen(mailru.app.events.applicationReviewStatus, function(d){cl(collectData(d))});
			  mailru.events.listen(mailru.app.events.applicationSettingsStatus, function(d){cl(collectData(d))});
			  mailru.events.listen(mailru.app.events.permissionsChange, function(d){cl(collectData(d))});
			  mailru.events.listen(mailru.app.events.streamPublish, function(d){cl(collectData(d))});
			  mailru.events.listen(mailru.app.events.guestbookPublish, function(d){cl(collectData(d))});
			  mailru.events.listen(mailru.app.events.permissionDialogStatus, function(d){cl(collectData(d))});
            });
			
			
            
            function collectData(d){
                var o = '';
                for (var p in d){
                    if(d.hasOwnProperty(p))
						if(typeof d[p] === 'object'){
							o += collectData(d[p]);
						}
						else
                        	o += p + '->' + d[p] + '\n';
                };
                return o;
            }
            
            function payment(){
                  //mailru.app.payments.showDialog({service_id: 1, service_name: 'РЅР°Р·РІР°РЅРёРµ', sms_price: 1, other_price: 2000});
                  mailru.app.payments.showDialog({service_id: 1, service_name: 'Р Р…Р В°Р В·Р Р†Р В°Р Р…Р С‘Р Вµ', sms_price: 1, other_price: 2000});
                  return false;
			}
			
			function invite(){
				mailru.app.friends.invite({name: 'test.app invite', logo: ''});
				return false;
			}
			
			function review(){
				mailru.app.users.review();
				return false;
			}
			
			function permission(type){
				mailru.app.users.settings();
				return false;
			}			
			
			function permission(type){
				mailru.common.users.requirePermissions(type);
				return false;
			}
			
			function guestbook(){
				mailru.common.guestbook.publish({text: 'Добавляем запись в гостевую', uid: user.uid});
				return false;
			}
			
			function stream(){
				mailru.common.stream.publish({text: 'Добавляем запись в Что нового'});
				return false;
			}
			
			function createAlbum(){
				mailru.common.photos.createAlbum({name: 'Тестовый альбом'});
				mailru.events.listen(mailru.common.events.createAlbum, function(result){
					$('photo').style.display = 'block';
					aid = result.aid;
				})
				return false;
			}
             
			function upload(){
				mailru.common.photos.upload({aid: aid, img: 'http://content.foto.mail.ru/corp/novikov/_connect/i-558.jpg'});
				return false;
			}
        </script>  
    </body>
</html>